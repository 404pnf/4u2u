/home/myapp/swftools/bin/pdf2swf $f -o tmp/$f.%.swf -s languagedir=/home/myapp/xpdf/etc/


# what i have been through

Thank you Chris and Irving.  I solved the problem.

First, install all  neccesary fonts from xpdf.  

	$sudo apt-cache search xpdf-*
	
Install them all

	$ sudo apt-get install xpdf-*
	Reading package lists... Done
	Building dependency tree       
	Reading state information... Done
	Note, selecting xpdf-greek for regex 'xpdf-*'
	Note, selecting xpdf-thai for regex 'xpdf-*'
	Note, selecting xpdf-korean for regex 'xpdf-*'
	Note, selecting xpdf-japanese for regex 'xpdf-*'
	Note, selecting xpdf-turkish for regex 'xpdf-*'
	Note, selecting xpdf-utils for regex 'xpdf-*'
	Note, selecting xpdf-cyrillic for regex 'xpdf-*'
	Note, selecting xpdf-reader for regex 'xpdf-*'
	Note, selecting xpdf-latin2 for regex 'xpdf-*'
	Note, selecting xpdf-i for regex 'xpdf-*'
	Note, selecting xpdf-chinese-simplified for regex 'xpdf-*'
	Note, selecting xpdf for regex 'xpdf-*'
	Note, selecting xpdf-chinese-traditional for regex 'xpdf-*'
	Note, selecting xpdf-hebrew for regex 'xpdf-*'
	Note, selecting xpdf-common for regex 'xpdf-*'
	0 upgraded, 0 newly installed, 0 to remove and 1 not upgraded.


Force system's fontconfig to be refreshed by using  "fc-cache -fv".

Go to /etc/xpdf/ , look around.  These are system-wide configuration files.  

Since the pdf2swf takes the -s languagedir= option, we can specify it to /etc/xpdf/ .

But it won't work! 

	$ pdf2swf  165660001.pdf -o tmp/1967.%.swf -s languagedir=/etc/xpdf
	NOTICE  Adding /etc/xpdf to language pack directories
	ERROR   Could not open /etc/xpdf/add-to-xpdfrc

The reason is that pdf2swf seeks for add-to-xpdfrc file.  The file has to be there!  Simply cp /etc/xpdf/includes /etc/xpdf/add-to-xpdfrc will do the trick.  Since the includes file include all other configuration file.

	/etc/xpdf$ cat includes 
	# This file was automatically generated by /usr/sbin/update-xpdfrc.
	# Instead, add or remove files in /etc/xpdf/ then run
	# /usr/sbin/update-xpdfrc to regenerate this file.

	include /etc/xpdf/xpdfrc-greek
	include /etc/xpdf/xpdfrc-japanese
	include /etc/xpdf/xpdfrc-chinese-simplified
	include /etc/xpdf/xpdfrc-korean
	include /etc/xpdf/xpdfrc-cyrillic
	include /etc/xpdf/xpdfrc-hebrew
	include /etc/xpdf/xpdfrc-latin2
	include /etc/xpdf/xpdfrc-thai
	include /etc/xpdf/xpdfrc-arabic
	include /etc/xpdf/xpdfrc-chinese-traditional
	include /etc/xpdf/xpdfrc-turkish

Another way is to copy to includes file to somewhere else and rename it to add-to-xpdfrc.  E.g, put it in your ~/pdf2swf.conf/add-to-xpdfrc .  Then run,

	$pdf2swf file.pdf -o /tmp/file.%.swf -s languagedir = ~/pdf2swf.conf/
	

On a ubuntu gnu/linux with swftools 0.9.0, the aboved confi solved most of fonts problem.  On a centos 5.5, I ended up compile everyting from source: swftools, t1lib, xpdf, freetype2 AND copy the /usr/share/fonts /usr/share/xpdf from ubuntu to centos.  The builds for centos are too out-dated!

There's only one issue remain with cmap.

	Error: Illegal entry in bfchar block in ToUnicode CMap
	NOTICE  processing PDF page 1 (408x595:0:0) (move:-422:0)
	NOTICE  File contains jpeg pictures
	NOTICE  Writing SWF file tmp/test.1.swf
	NOTICE  processing PDF page 2 (408x591:0:0) (move:-3:-9)
	NOTICE  File contains shaded fills
	NOTICE  File contains axial shaded fills
	NOTICE  File contains soft masks
	NOTICE  File contains forms
	NOTICE  File contains transparency groups
	NOTICE  File contains pbm pictures 
	WARNING multiply blended transparency groups not yet supported!
	NOTICE  Writing SWF file tmp/test.2.swf
	NOTICE  processing PDF page 3 (407x591:0:0) (move:-25:-25)
	NOTICE  Writing SWF file tmp/test.3.swf
	NOTICE  processing PDF page 4 (407x591:0:0) (move:-25:-25)
	NOTICE  Writing SWF file tmp/test.4.swf

The output swf is OK.  But I don't know what the error is about.


----



Question 1:

Could someone explaines in detail the formate of add-to-xpdfrc?  How should I add character collection and ttf font?

Question 2: 

I have Adobe-Japan1-4, why does swftools complain about not have Adobe-Japan1?

----

What I tried: 

I downloaded the CJK font at http://partners.adobe.com/public/developer/font/index.html , and put them in /usr/share/xpdf/xpdf-chinese-simplified. 

	$ ls
	00_ReadMe.pdf	 Adobe-GB1-UCS2		 GBK-EUC-UCS2	 H
	83pv-RKSJ-H	 Adobe-GB1.cidToUnicode  GBK-EUC-V	 ISO-2022-CN.unicodeMap
	90ms-RKSJ-H	 Adobe-Japan1-4		 GBK.unicodeMap  README
	90ms-RKSJ-UCS2	 Adobe-Japan1-UCS2	 GBK2K-H	 UniGB-UCS2-H
	90ms-RKSJ-V	 CMap			 GBK2K-V	 UniGB-UCS2-V
	90msp-RKSJ-H	 EUC-CN.unicodeMap	 GBKp-EUC-H	 UniJIS-UCS2-H
	90msp-RKSJ-V	 EUC-H			 GBKp-EUC-V	 UniJIS-UCS2-HW-H
	90pv-RKSJ-H	 EUC-V			 GBT-EUC-H	 UniJIS-UCS2-HW-V
	90pv-RKSJ-UCS2	 Ext-RKSJ-H		 GBT-EUC-V	 UniJIS-UCS2-V
	90pv-RKSJ-UCS2C  Ext-RKSJ-V		 GBpc-EUC-H	 V
	Add-RKSJ-H	 GB-EUC-H		 GBpc-EUC-UCS2	 add-to-xpdfrc
	Add-RKSJ-V	 GB-EUC-V		 GBpc-EUC-UCS2C  ls.txt
	Adobe-GB1-4	 GBK-EUC-H		 GBpc-EUC-V

Then, I began to convert some pdfs.

	$ pdf2swf  167680001.pdf -o tmp/test.swf -s languagedir=/usr/share/xpdf/xpdf-chinese-simplified/
	NOTICE  Adding /usr/share/xpdf/xpdf-chinese-simplified/ to language pack directories
	Error: Couldn't open cidToUnicode file '/usr/share/xpdf/xpdf-chcinese-simplified/GBpc-EUC-H'
	Error: Unknown character collection 'Adobe-GB1'
	Error: Couldn't find a font for 'STXihei'
	Error: Couldn't find a font for 'STXihei'

I didn't have the font.  I downloaded it here: http://cid-a304a3ed04e117fd.office.live.com/self.aspx/Font/STXIHEI.TTF

Then I copied it to /usr/share/xpdf/xpdf-chinese-simplified/ folder.  And add a line to add-to-xpdfrc

		displayCIDFontTT	Adobe-GB1	/usr/share/xpdf/xpdf-chinese-simplified/STXIHEI.TTF

Re-runt the command: 

	$ pdf2swf  167680001.pdf -o tmp/test.swf -s languagedir=/usr/share/xpdf/xpdf-chinese-simplified/

Now, it works. 

	NOTICE  processing PDF page 61 (505x647:0:0) (move:-541:-36)
	NOTICE  Writing SWF file tmp/1676.61.swf
	NOTICE  processing PDF page 62 (505x647:0:0) (move:-36:-36)
	NOTICE  Writing SWF file tmp/1676.62.swf

I moved on to another pdf:

	$ pdf2swf  165660001.pdf -o tmp/1676.%.swf -s languagedir=/usr/share/xpdf/xpdf-chinese-simplified/
	NOTICE  Adding /usr/share/xpdf/xpdf-chinese-simplified/ to language pack directories
	NOTICE  outputting one file per page
	Error: Unknown character collection 'Adobe-Japan1'

I thought i had Adobe-Japan1, 

	$ ls Adobe-J*
	Adobe-Japan1-4	Adobe-Japan1-UCS2

I read that one should edit the add-to-xpdfrc file as following for CJK compability, I sensed I messed up there.

Here's my add-to-xpdfrc

	$ cat add-to-xpdfrc 
	#----- begin Chinese Simplified support package (2004-jul-27)
	cidToUnicode	Adobe-GB1	/usr/share/xpdf/xpdf-chinese-simplified/Adobe-GB1.cidToUnicode
	#cidToUnicode	Adobe-Japan1	/usr/share/xpdf/xpdf-chinese-simplified/Adobe-Japan1-4
	unicodeMap	Adobe-Japan1	/usr/share/xpdf/xpdf-chinese-simplified/Adobe-Japan1-4
	unicodeMap	ISO-2022-CN	/usr/share/xpdf/xpdf-chinese-simplified/ISO-2022-CN.unicodeMap
	unicodeMap	EUC-CN		/usr/share/xpdf/xpdf-chinese-simplified/EUC-CN.unicodeMap
	unicodeMap	Adobe-GB1	/usr/share/xpdf/xpdf-chcinese-simplified/GBpc-EUC-H
	unicodeMap	GBK		/usr/share/xpdf/xpdf-chinese-simplified/GBK.unicodeMap
	cMapDir		Adobe-GB1	/usr/share/xpdf/xpdf-chinese-simplified/CMap
	toUnicodeDir			/usr/share/xpdf/xpdf-chinese-simplified/CMap
	displayCIDFontTT	Adobe-GB1	/usr/share/xpdf/xpdf-chinese-simplified/STXIHEI.TTF
#----- end Chinese Simplified support package

How should I add more font?  Or, do I have to add those font one by one? If so, how?  I don't understand the format here, like should i prefix GBpc-EUC-H with cidToUnicode or unicodeMap ?

